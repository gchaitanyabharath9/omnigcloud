name: Future Dev/SIT Pipeline

on:
  push:
    branches:
      - "dev"
  pull_request:
    branches:
      - "dev"
  workflow_dispatch:

env:
  APP_ENV: dev

permissions:
  contents: read

jobs:
  # 1. QA/CI Gates - Always run for dev branch, regardless of deployment flag
  quality_gates:
    name: üõ°Ô∏è Quality Gates (CI)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

      - name: Setup Node.js
        uses: actions/setup-node@393700c4314b93198f82875f5bc9fa4219b2585f # v4.1.0
        with:
          node-version: "20"
          cache: "npm"

      - name: Install Dependencies
        run: npm ci

      - name: Lint
        run: npm run lint

      - name: Typecheck
        run: npm run typecheck

      # Builds with 'dev' config to verify it builds
      - name: Build (Dev Profile)
        run: npm run build
        env:
          APP_ENV: "sit"

      - name: QA Inventory Check
        run: npm run qa:inventory

      - name: QA i18n Coverage
        run: npm run qa:i18n

  # 2. Deployment - Guarded by Repository Variable
  deploy_sit:
    name: üöÄ Deploy to SIT
    runs-on: ubuntu-latest
    needs: quality_gates
    # CRITICAL: This job only runs if the repo variable is explicitly 'true'
    # If variable is missing or 'false', this skips.
    if: ${{ vars.ENABLE_SIT_PIPELINE == 'true' }}
    environment:
      name: sit
    env:
      APP_ENV: "sit"
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

      - name: Deploy Information
        run: |
          echo "üöÄ SIT Deployment Active"
          echo "Environment: sit"
          echo "Config Source: src/config/sit/app.json"

      # Add real deployment steps here (e.g. Vercel, AWS)
      # when ready to enable.
