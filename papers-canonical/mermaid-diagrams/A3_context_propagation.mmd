graph TB
    Request[User Request<br/>order_id=abc123]
    
    subgraph Context["W3C Trace Context Propagation"]
        Gateway[API Gateway<br/>traceparent: 00-abc...123-01]
        Payment[Payment Service<br/>traceparent: 00-abc...123-02]
        DB[Database<br/>traceparent: 00-abc...123-03]
        Settlement[Settlement Service<br/>traceparent: 00-abc...123-04]
        
        Gateway --> Payment
        Payment --> DB
        Payment --> Settlement
        
        style Gateway fill:#4A90E2,stroke:#2E5C8A,color:#fff
        style Payment fill:#50C878,stroke:#2E7D4E,color:#fff
        style DB fill:#FF6B6B,stroke:#CC5555,color:#fff
        style Settlement fill:#A78BFA,stroke:#7C3AED,color:#fff
    end
    
    Request --> Gateway
    
    subgraph Sovereign["Sovereign Context Extension"]
        SC1[tracestate:<br/>cell_id=us-east-1-cell-5]
        SC2[tracestate:<br/>compliance=PCI_DSS]
        SC3[tracestate:<br/>region=US]
        
        style SC1 fill:#DBEAFE,stroke:#2563EB
        style SC2 fill:#DBEAFE,stroke:#2563EB
        style SC3 fill:#DBEAFE,stroke:#2563EB
    end
    
    Gateway -.->|Adds| SC1
    Gateway -.->|Adds| SC2
    Gateway -.->|Adds| SC3
    
    Collector[A3 Collector<br/>Assembles Full Trace]
    Settlement --> Collector
    DB --> Collector
    
    Collector --> Analysis[Residency Analysis<br/>Verify all spans in US region]
    
    style Collector fill:#FEF3C7,stroke:#D97706,color:#333
    style Analysis fill:#D1FAE5,stroke:#059669,color:#333
