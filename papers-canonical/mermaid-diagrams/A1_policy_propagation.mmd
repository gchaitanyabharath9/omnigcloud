graph LR
    Author[Security Team<br/>Writes Rego Policy] --> Compiler[Policy Compiler<br/>Rego â†’ WASM]
    Compiler --> Registry[Policy Registry<br/>Versioned Storage]
    Registry --> Kafka[Kafka Topic<br/>policy-updates]
    Kafka --> Node1[Data Plane Node 1<br/>WASM Runtime]
    Kafka --> Node2[Data Plane Node 2<br/>WASM Runtime]
    Kafka --> Node3[Data Plane Node 3<br/>WASM Runtime]
    Kafka --> NodeN[Data Plane Node N<br/>WASM Runtime]
    Node1 --> Audit[Audit Aggregator<br/>Compliance Log]
    Node2 --> Audit
    Node3 --> Audit
    NodeN --> Audit
    
    Node1 -.->|Policy Decision| Request1[Request 1<br/>< 1ms eval]
    Node2 -.->|Policy Decision| Request2[Request 2<br/>< 1ms eval]
    Node3 -.->|Policy Decision| Request3[Request 3<br/>< 1ms eval]
    NodeN -.->|Policy Decision| RequestN[Request N<br/>< 1ms eval]
    
    style Author fill:#4CAF50,color:#fff
    style Compiler fill:#2196F3,color:#fff
    style Kafka fill:#FF9800,color:#fff
    style Audit fill:#9C27B0,color:#fff
    style Node1 fill:#E8F5E9,stroke:#4CAF50,stroke-width:2px
    style Node2 fill:#E8F5E9,stroke:#4CAF50,stroke-width:2px
    style Node3 fill:#E8F5E9,stroke:#4CAF50,stroke-width:2px
    style NodeN fill:#E8F5E9,stroke:#4CAF50,stroke-width:2px
