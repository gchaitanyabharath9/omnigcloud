sequenceDiagram
    participant Client
    participant Ingress
    participant TokenBucket
    participant Log
    participant Consumer
    
    Client->>Ingress: HTTP POST /events
    Ingress->>TokenBucket: consume(1)
    alt Tokens Available
        TokenBucket-->>Ingress: OK
        Ingress->>Log: append(event)
        Log-->>Ingress: ACK
        Ingress-->>Client: 202 Accepted
    else No Tokens (Overload)
        TokenBucket-->>Ingress: REJECT
        Ingress-->>Client: 429 Too Many Requests
    end
    
    Consumer->>Log: pull_batch()
    Log-->>Consumer: events[]
    Consumer->>Consumer: process_events()
    alt Consumer Lag > Threshold
        Consumer->>TokenBucket: reduce_rate()
    else Consumer Healthy
        Consumer->>TokenBucket: increase_rate()
    end
