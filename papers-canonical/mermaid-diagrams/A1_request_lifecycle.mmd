sequenceDiagram
    participant Client
    participant Gateway as API Gateway
    participant RateLimit as Token Bucket
    participant Router as Cell Router
    participant WASM as Policy WASM
    participant Service as Business Service
    participant DB as Database
    participant Audit as Audit Log
    
    Client->>Gateway: HTTP POST /api/orders
    Gateway->>RateLimit: consume(tenant_id, 1)
    alt Quota Available
        RateLimit-->>Gateway: OK
        Gateway->>Router: route(tenant_id)
        Router-->>Gateway: cell_3
        Gateway->>WASM: evaluate(policy, request)
        WASM-->>Gateway: ALLOW
        Gateway->>Service: process_order(request)
        Service->>DB: INSERT INTO orders
        DB-->>Service: ACK
        Service-->>Gateway: order_id
        Gateway-->>Client: 201 Created
        Gateway->>Audit: log_decision(ALLOW)
    else Quota Exceeded
        RateLimit-->>Gateway: REJECT
        Gateway-->>Client: 429 Too Many Requests
        Gateway->>Audit: log_decision(RATE_LIMITED)
    end
    
    Note over Gateway,WASM: Policy evaluation < 1ms
    Note over Service,DB: Business logic < 100ms
    Note over Gateway,Audit: Async audit logging
